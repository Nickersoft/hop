#!/usr/bin/env node
var N=Object.create;var m=Object.defineProperty;var U=Object.getOwnPropertyDescriptor;var L=Object.getOwnPropertyNames;var _=Object.getPrototypeOf,F=Object.prototype.hasOwnProperty;var g=t=>m(t,"__esModule",{value:!0});var W=(t,r)=>{g(t);for(var o in r)m(t,o,{get:r[o],enumerable:!0})},J=(t,r,o)=>{if(r&&typeof r=="object"||typeof r=="function")for(let e of L(r))!F.call(t,e)&&e!=="default"&&m(t,e,{get:()=>r[e],enumerable:!(o=U(r,e))||o.enumerable});return t},n=t=>J(g(m(t!=null?N(_(t)):{},"default",t&&t.__esModule&&"default"in t?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t);var G=n(require("commander"));var h={};W(h,{install:()=>H,ls:()=>K});var A=n(require("ora")),v=n(require("commander"));var w=n(require("@octokit/rest")),y=new w.Octokit;var l={repo:{owner:"Nickersoft",name:"hop"},defaultUserAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.114 Safari/537.36"};var K=new v.Command("ls").action(async()=>{let t=(0,A.default)({hideCursor:!0}).start(),{data:r}=await y.rest.repos.getContent({owner:l.repo.owner,repo:l.repo.name,path:"apps"});t.stop(),console.log(`
Available Apps:
===============
`);let o=r.map(({name:e})=>`- ${e}`).sort();console.log(o.join(`
`)),console.log(`
`)});var B=n(require("ora")),D=n(require("commander"));var b=n(require("nativefier"));var x=n(require("tmp")),c=()=>new Promise((t,r)=>{x.default.dir({keep:!0},(o,e,a)=>{o?r(o):t({path:e,cleanup:a})})});var S=async({manifest:t,cleanup:r,icon:o})=>{process.env.ELECTRON_ENABLE_LOGGING="false";let{path:e,cleanup:a}=await c(),i=await(0,b.buildNativefierApp)({name:t.name,targetUrl:t.url,platform:"darwin",internalUrls:".*?",userAgent:l.defaultUserAgent,out:e,...o&&{icon:o},...t.titleBar===!1&&{titleBarStyle:"hidden"}});if(i)return{path:i,cleanup:()=>{a(),r()}};throw new Error("App path is undefined! Not sure what happened :/")};var f=n(require("fs-extra")),$=n(require("path")),k=(t,r=!1)=>{let e=(0,f.readdirSync)(t).filter(a=>a.endsWith(".app"))?.[0];if(!e)throw new Error("Could not find app in build directory!");(0,f.moveSync)((0,$.join)(t,e),`/Applications/${e}`,{overwrite:r})};var u=n(require("axios")),E=n(require("js-yaml")),P=n(require("fs"));var C=n(require("ajv")),M=n(require("ajv-formats")),R={type:"object",properties:{name:{type:"string"},description:{type:"string"},url:{type:"string",format:"uri"},icon:{type:"string",nullable:!0},titleBar:{type:"boolean",default:!0,nullable:!0}},required:["name","url"],additionalProperties:!1},j=new C.default;(0,M.default)(j);var q=j.compile(R),T=t=>q(t);var z=async t=>{let r=`https://raw.githubusercontent.com/Nickersoft/hop/master/apps/${t}/icon.png`,{path:o,cleanup:e}=await c(),a=`${o}/icon.png`,{data:i}=await(0,u.default)({method:"GET",url:r,responseType:"stream"});return i.pipe((0,P.createWriteStream)(a)),new Promise((p,s)=>{i.on("end",()=>{p({path:a,cleanup:e})}),i.on("error",d=>{s(d)})})},O=async t=>{let r=`https://raw.githubusercontent.com/Nickersoft/hop/master/apps/${t}/manifest.yml`;try{let{data:o}=await u.default.get(r),e=null,a=()=>{};try{let{path:p,cleanup:s}=await z(t);e=p,a=s}catch(p){}let i=E.default.load(o);if(!T(i))throw new Error(`Invalid manifest found for ${t}. Skipping installation`);return{manifest:i,icon:e,cleanup:a}}catch(o){throw o.response.status===404?new Error(`Couldn't find app: ${t}. Skipping installation.`):o}};var H=new D.Command("install").argument("<apps...>").option("-f, --overwrite","overwrites the app if it already exists").action((t,{overwrite:r})=>{Promise.all(t.map(async o=>{let e=(0,B.default)(`Resolving app '${o}'...`).start(),a=()=>{};try{let i=await O(o),p=i.manifest.name;e.text=`Building ${p}...`;let{path:s,cleanup:d}=await S(i);a=d,e.text=`Installing ${p}...`,k(s,r??!1),e.text="Cleaning up...",a(),e.succeed(`Successfully installed ${p}!`)}catch(i){e.fail(`Failed to install ${o} with error: "${i.toString()}"`),a()}}))});var I=new G.Command;Object.values(h).forEach(t=>I.addCommand(t));I.parse(process.argv);
//# sourceMappingURL=cli.js.map
